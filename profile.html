<!DOCTYPE html>
<html lang="ru">
<head>
  <link rel="stylesheet" href="chat.css">
  <meta charset="UTF-8">
  <title>Профиль — BookShare</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: 'Poppins', sans-serif; background:#f6f2ec; margin:0; }
    header { background:#3a322b; color:#fff; padding:14px 100px; }
    .card { background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.06); }
    .left { width:260px; text-align:center; }
    .avatar {
      width:160px; height:160px; border-radius:50%; object-fit:cover; border:4px solid #f0e7df;
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
    .input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #ddd; margin-top:10px; }
    .save-btn { background:#5b3921; color:#fff; padding:10px 16px; border-radius:8px; border:none; cursor:pointer; margin-top:12px; }
    .logout-btn { background:#c94b3b; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; margin-top:8px; }
    .right { flex:1; }
    .info-row { display:flex; justify-content:space-between; gap:20px; margin-bottom:12px; }
    label { font-weight:600; color:#483A2D; }
  </style>
</head>
<body>
  <header>
    <h1>BookShare</h1>

    <div class="header-buttons">
        <a href="Us Contact.html" class="header-btn">Наши Контакты</a>
        <a href="catalog.html" class="header-btn">Kаталог</a>
        <a href="cart.html" class="header-btn">Корзина</a>
    </div>
</header>

  <div class="profile-container">

    <!-- Аватар -->
    <div class="profile-section">
        <img id="avatarImg" class="avatar" src="images/avatar-placeholder.png" alt="Аватар">
        <input id="avatarFile" type="file" accept="image/*" class="input">
        <button id="logoutBtn" class="logout-btn">Выйти</button>
    </div>

    <!-- Информация о пользователе -->
    <div class="profile-section">
        <h2>Профиль пользователя</h2>

        <label>Имя</label>
        <input id="nameInput" class="input center-input" placeholder="Имя пользователя">

        <label>Электронная почта</label>
        <input id="emailInput" class="input center-input" placeholder="email@example.com">

        <label>О себе</label>
        <textarea id="bio" class="input center-input" rows="4" placeholder="Немного о себе..."></textarea>

        <button id="saveBtn" class="save-btn">Сохранить профиль</button>
    </div>

</div>



  <footer class="copyright">
    <p>&#169; 2025 BookShare — все права защищены кошкой</footer>

  <script>
    // Ключ в localStorage
    const PROFILE_KEY = 'userProfile';

    function dataURLtoFile(dataurl, filename) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new File([u8arr], filename, { type: mime });
    }

    // загрузка текущего профиля
    function loadProfile() {
      const raw = localStorage.getItem(PROFILE_KEY);
      if (!raw) return;
      const p = JSON.parse(raw);
      document.getElementById('nameInput').value = p.name || '';
      document.getElementById('emailInput').value = p.email || '';
      document.getElementById('bio').value = p.bio || '';
      if (p.avatar) document.getElementById('avatarImg').src = p.avatar;
    }

    document.getElementById('saveBtn').addEventListener('click', () => {
      const profile = {
        name: document.getElementById('nameInput').value.trim(),
        email: document.getElementById('emailInput').value.trim(),
        bio: document.getElementById('bio').value.trim(),
        avatar: document.getElementById('avatarImg').src
      };
      localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
      alert('Профиль сохранён');
    });

    // загрузка аватара в base64
    document.getElementById('avatarFile').addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById('avatarImg').src = ev.target.result;
      };
      reader.readAsDataURL(f);
    });

    // logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      // можно удалять profile или просто перейти на вход
      // localStorage.removeItem(PROFILE_KEY);
      window.location.href = 'login.html';
    });

    // init
    loadProfile();
    const currentUser = 'user1'; // имя текущего пользователя (можно менять при авторизации)
const otherUser = 'user2';   // с кем ведётся переписка

function sendMessage() {
  const text = document.getElementById('messageText').value.trim();
  if (!text) return;
  const messages = JSON.parse(localStorage.getItem('messages') || '[]');
  messages.push({from: currentUser, to: otherUser, text});
  localStorage.setItem('messages', JSON.stringify(messages));
  document.getElementById('messageText').value = '';
  renderMessages();
}

function renderMessages() {
  const messages = JSON.parse(localStorage.getItem('messages') || '[]');
  const chatWindow = document.getElementById('chatWindow');
  chatWindow.innerHTML = '';
  messages.forEach(msg => {
    if ((msg.from === currentUser && msg.to === otherUser) ||
        (msg.from === otherUser && msg.to === currentUser)) {
      const div = document.createElement('div');
      div.className = msg.from === currentUser ? 'message-sent' : 'message-received';
      div.textContent = msg.text;
      chatWindow.appendChild(div);
    }
  });
  chatWindow.scrollTop = chatWindow.scrollHeight; // прокрутка вниз
}

// навесить обработчик
document.getElementById('sendBtn').addEventListener('click', sendMessage);

// загрузка сообщений при открытии
renderMessages();

  </script>
</body>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="profile.css">
</html>
